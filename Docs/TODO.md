# Project TODO List (Generated by Cascade AI)

This document outlines the completed and pending tasks for the Ceramics Studio Check-In App, referenced against `PRD.md` (v0.3).

## I. Overall Progress

Estimated completion: **30-40%** of MVP requirements.

Key areas of progress include foundational project structures, initial UI for mobile check-in, admin member management, and basic backend setup. Significant work remains in implementing core logic, full feature integration, security, and testing.

## II. Task Breakdown

### A. Backend (Supabase)

#### Completed / In Progress:

- `[x]` Basic table structure for `members` and `sessions` created (`migrations/20250518_0000_init.sql`).
- `[x]` Row-Level Security (RLS) enabled at the table level.
- `[x]` Cron job file `autoCheckout.ts` created (B-2).
- `[x]` Database schema finalized (PRD: Section 7).

#### To Do (Suggested Order):

1.  **Core Check-in/out Logic (PRD: B-1, Overlap Rule)**
    - `[x]` Implement Supabase Edge Function for `check_in`.
        - `[x]` Include "Overlap rule" logic (update existing session if open).
    - `[x]` Implement Supabase Edge Function for `check_out`.
    - `[x]` Implement admin interface for user management
        - `[x]` Create admin screens (dashboard, user list, add/edit user)
        - `[x]` Implement role-based access control (admin, staff, member)
        - `[x]` Add user status management (active, inactive, suspended)
        - `[x]` Implement password reset functionality
        - `[x]` Add audit logging for admin actions
        - `[x]` Create database migrations for admin features
        - `[x]` Implement permission utilities and hooks
2.  **Database Schema Finalization (PRD: Section 7)**
    - `[x]` Align `members` table with PRD: add `email`, `photo_url`, `status`; ensure `full_name` (or map `firstName`, `lastName`).
    - `[x]` Align `sessions` table with PRD: use `check_in`, `check_out`; add `auto_closed` boolean.
    - `[x]` Create `profiles` table for user roles and additional profile data
    - `[x]` Add database functions for check-in/check-out operations
    - `[x]` Implement auto-checkout function for sessions exceeding max duration
    - `[x]` Add comprehensive RLS policies for all tables
    - `[x]` Create necessary indexes for performance
    - `[x]` Add database triggers for updated_at timestamps
    - `[x]` Add comments and documentation for all database objects
3.  **Row-Level Security Policies (PRD: B-3)**
    - `[x]` Define and implement RLS policies for `members` (e.g., members can read their own, admin can read all).
    - `[x]` Define and implement RLS policies for `sessions` (e.g., members can read their own, admin can read all).
4.  **Auto Check-out Logic (PRD: B-2)**
    - `[x]` Implement the core logic within `supabase/functions/autoCheckout.ts` (handles 12h timeout; geofence exit TBD).
5.  **Security (PRD: S-1, S-2, S-3, S-4, S-6, S-7 - Backend aspects)**
    - `[x]` Ensure secure handling of invites/password resets (Leveraging Supabase built-in features).
    - `[~]` Implement rate limiting for Edge Functions (Relying on Supabase service limits for now; revisit if needed).
    - `[~]` Ensure PII masking in backend logs (Ongoing: current logging uses non-sensitive IDs).

### B. Mobile App (React Native / Expo)

#### Completed / In Progress:

- `[x]` Basic React Native (Expo) project structure (`mobile/`).
- `[x]` `SwipeCheckIn.tsx` component created (supports F-2).
- `[x]` `useBackgroundGeofence.ts` hook created (supports F-3).
- `[x]` `useOfflineQueue.ts` hook created (supports F-4).
- `[x]` Initial localization setup (`locales/`, `i18n.ts`) (F-5).
- `[x]` API call structure for `checkIn.ts` (connects to B-1).
- `[x]` Basic testing structure in place (`__tests__/`).

#### To Do (Suggested Order):

1.  **Authentication (PRD: F-1, S-1, S-2, S-3, S-4)**
    - `[x]` Implement Email + Password login screen and logic
    - `[x]` Integrate with Supabase Auth
    - `[x]` Implement session retention (secure token storage)
    - `[x]` Implement password strength checks (client-side validation)
        - Added zxcvbn-ts for password strength validation
        - Visual feedback for password requirements
        - Real-time validation in both sign-up and password reset flows
    - `[x]` Implement password reset flow UI and logic
        - Forgot password screen
        - Password reset with token validation
        - Password strength enforcement
    - `[x]` Add user registration flow
        - Sign-up screen with full name, email, and password
        - Client-side validation
        - Automatic profile creation in members table
    - `[x]` Implement role-based navigation and access control
    - `[ ]` Handle rate limiting feedback from backend
    - `[ ]` Implement session expiry and token refresh logic
    - `[ ]` Add email verification flow
        - UI for resending verification email
        - Handling of verification status in the app
2.  **Core Check-in Screen & Flow (PRD: F-2)**
    - `[~]` Integrate `SwipeCheckIn.tsx` into main app flow post-login (Auth layout and login redirect implemented).
    - `[ ]` Implement display of current check-in status.
    - `[ ]` Implement session timer display.
    - `[ ]` Connect `checkIn.ts` API call to `SwipeCheckIn.tsx` and backend `check_in` function.
    - `[ ]` Implement manual "Slide to Check Out" and connect to backend `check_out` function.
3.  **Geofence & Auto Check-out Integration (PRD: F-3, S-5)**
    - `[ ]` Fully implement logic within `useBackgroundGeofence.ts` (150m radius, 12h max session override).
    - `[ ]` Integrate with `check_out` backend function when geofence conditions met.
    - `[ ]` Implement robust location permission handling (iOS Always, Android 14+ Background, graceful fallback as per S-5).
        - `[ ]` Draft and implement copy for second-chance dialog (Open Item #3).
4.  **Offline Queue & Sync (PRD: F-4)**
    - `[ ]` Fully implement logic within `useOfflineQueue.ts` (LocalStorage, sync when online).
    - `[ ]` Ensure server upserts on sync for overlapping sessions (Open Item #2).
    - `[ ]` Define and implement offline queue cap (25 unsynced events - Open Item #2).
5.  **Localization Content (PRD: F-5)**
    - `[ ]` Add all English and Swedish copy for UI elements.
6.  **Accessibility (PRD: Non-Functional)**
    - `[ ]` Ensure system font ≥ 18 pt.
    - `[ ]` Verify WCAG 2.1 AA contrast for all UI elements.
7.  **Testing**
    - `[ ]` Write unit/integration tests for components, hooks, and API interactions.

### C. Admin Web Dashboard (Next.js)

#### Completed / In Progress:

- `[x]` Basic Next.js project structure (`admin/`).
- `[x]` Member CRUD UI components (`MemberForm.tsx`, `MembersList.tsx`, `MembersTable.tsx`) and page structure (`admin/app/members/`) largely in place (A-1).
- `[x]` Occupancy widget (`OccupancyWidget.tsx`) and dashboard structure (`admin/app/dashboard/occupancy/`) in place (A-3).
- `[x]` `RoleGuard.tsx` for basic role protection.
- `[x]` Basic testing structure in place (`__tests__/`, `e2e/`).

#### To Do (Suggested Order):

1.  **Authentication**
    - `[ ]` Implement Admin login (e.g., using Supabase Auth with specific admin roles).
    - `[ ]` Integrate `RoleGuard.tsx` effectively post-login.
2.  **Session Management View (PRD: A-2)**
    - `[ ]` Create component/page to display table of sessions from `sessions` table.
    - `[ ]` Implement filtering by date.
    - `[ ]` Implement CSV export functionality for sessions.
3.  **Members CRUD - Backend Integration (PRD: A-1)**
    - `[ ]` Connect `MemberForm.tsx` and list views to Supabase backend for actual data operations.
    - `[ ]` Implement profile photo upload/display if required by `photo_url`.
4.  **Occupancy Widget - Backend Integration (PRD: A-3)**
    - `[ ]` Connect `OccupancyWidget.tsx` to backend to fetch real-time (or near real-time) occupancy data.
5.  **Security (PRD: S-6, other relevant NFRs)**
    - `[ ]` Ensure HSTS header is set.
    - `[ ]` Review for other OWASP Top-10 considerations.
6.  **Testing**
    - `[ ]` Write unit/integration tests for components and page functionalities.
    - `[ ]` Write E2E tests for key admin workflows (login, member CRUD, viewing occupancy).

### D. General / Cross-Cutting Concerns

#### Completed / In Progress:

- `[x]` Initial file naming conventions generally followed.
- `[x]` Config files for linting, commit messages (`.commitlint.config.cjs`) in place.

#### To Do (Suggested Order - ongoing throughout development):

1.  **PRD Open Items (PRD: Section 10)**
    - `[ ]` Finalize geofence constants (radius, check interval, misses for auto-checkout - Open Item #1).
    - `[ ]` Confirm Supabase Pro upgrade triggers (Open Item #4).
2.  **Security Hardening (PRD: S-1 to S-7, Non-Functional)**
    - `[ ]` Conduct thorough review and implementation of all security requirements across all platforms.
    - `[ ]` Plan for OWASP Top-10 scan quarterly.
3.  **Comprehensive Testing (PRD: Testing conventions, Non-Functional)**
    - `[ ]` Achieve target code coverage (e.g., ≥90% backend, ≥80% mobile statements).
    - `[ ]` Ensure Sentry integration for crash reporting and aim for ≥99% crash-free sessions.
4.  **CI/CD Pipeline (PRD: Architecture - CI/CD)**
    - `[ ]` Fully set up CI/CD pipeline (GitHub Actions or similar).
    - `[ ]` Include steps for linting, formatting, tests (Jest, Playwright), type-checking.
    - `[ ]` Implement `pnpm audit` and `pip-audit` checks with zero critical vulnerabilities.
5.  **Performance (PRD: Non-Functional)**
    - `[ ]` Monitor API p95 latency (≤ 300 ms).
    - `[ ]` Optimize mobile bundle size (≤ 3 MB).
6.  **Documentation**
    - `[ ]` Update READMEs as needed.
    - `[ ]` Document any complex or non-obvious logic.

## III. Next Steps - Suggested Focus Order

1.  **Backend Core:** Prioritize finalizing the core `check_in`/`check_out` Edge Functions and RLS policies. This is foundational for both mobile and admin apps.
2.  **Mobile UI Components:** Implement reusable UI components for the mobile app.
    - `[x]` Create Button component with variants and loading states
    - `[x]` Create Text component with typography variants
    - `[x]` Create Input component with validation
    - `[x]` Create Card component for content containers
    - `[x]` Create Loading component with different sizes
    - `[x]` Create Icon component with support for multiple icon libraries
    - `[x]` Create Badge component for status indicators
    - `[x]` Create Divider component for visual separation
    - `[x]` Create List component for displaying collections
    - `[x]` Create Modal component for dialogs and overlays
    - `[x]` Create Toast component for notifications
    - `[x]` Create Tooltip component for contextual help

3.  **Mobile Core Auth & Check-in:** Implement mobile user authentication and the primary check-in/out swipe flow, connecting it to the backend functions.
4.  **Mobile Advanced Features:** Integrate and thoroughly test geofencing and offline queueing.
5.  **Admin Core Auth & Views:** Implement admin authentication and the session viewing/export features.
6.  **Backend Support:** Complete `autoCheckout` cron logic.
7.  **Iterative Refinement & Testing:** Continuously test, address security requirements, implement non-functional requirements, and populate localization content across all platforms.
8.  **CI/CD & Polish:** Finalize CI/CD, address PRD open items, and perform final QA.